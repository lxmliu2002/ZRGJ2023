# ZRGJ2023

## 一、小组信息

* 队伍名：代码写的都队
* 队伍成员
  * [nkufree](https://github.com/nkufree)——前端开发
    * 搭建代码编辑器，接收外部输入代码，将所有的代码分块，每次将改变的代码块以Post请求方式发送给后端；根据后端返回分析变量类型，给出提示。
  * [lxmliu2002](https://github.com/lxmliu2002)——后端开发
    * 调用Python的AST库，对代码块进行语法分析，分析代码中的变量，调用的类和方法；查询Neo4j数据库分析部分变量类型，返回部分变量类型、类和方法。
  * [twinklelittlestars](https://github.com/twinklelittlestars)——Neo4j数据库构建和Web可视化
    * 按照已有的数据库架构完成数据库构建，并结合Django和Echarts完成Web界面的可视化设计。
  * [WangshuXC](https://github.com/WangshuXC)——数据爬取及预处理和数据库设计
    * 爬取Python官方说明文档以及Numpy和Pandas等第三方库官方说明文档，得到方法名称、参数、返回值等数据并完成数据的预处理，为项目提供数据支持；设计数据库架构。

## 二、项目概述

本项目基于Neo4j实现Python代码提示，解决了传统编译器由于数据类型不明确、第三方库函数等问题导致的没有代码提示的问题，帮助程序员省去借助type()函数实现代码提示的麻烦过程。将自定义类或函数加入到Neo4j数据库中，实现了根据上下文进行变量类型的推测，进而达到代码提示的目的。

项目选择人工智能方向，主要使用Django架构、Neo4j图数据库支持、Echarts可视化图表、Ace-editor、Jquery、AST等技术点，使用Python语言借助Visual Studio Code完成开发。

## 三、工作范围

本项目使用爬虫技术爬取Python官方的库函数说明文档，文档中未涉及的用法，本项目中未作拓展。由于时间条件限制，本项目中第三方库仅选取常用的第三方库进行爬取、存入Neo4j数据库，并未包含全部。

本项目选定Python语言为目标语言，暂不支持包括C++、Java等的其他语言。

## 四、功能需求

前端搭建一个简单的代码编辑器，接收输入的代码信息，并对其进行简单的分析，将其分析后得出的代码信息打包发送到后端进行处理。经后端处理后的信息返回到前端，以列表的形式呈现给用户，即实现代码提示功能。

后端接收前端发送的json语句，将代码编辑器中输入的代码进行语法分割，分析得到已输入代码的数据类型等相关信息。然后查询Neo4j数据库，基于已得到的关系，得到后续可能的方法、命名空间、类、属性等，将其打包发送到前端，实现代码提示功能。如果基于已知信息无法查询得到可能的后续代码，将返回None。

数据的爬取及处理上，爬取了Numpy官方文档以及Pands官方文档，得到了两个第三方库拥有的namespace以及method和parameters还有method返回的class。由于两个文档的布局、编写不统一，得到的数据较为杂乱，固需要在爬取时加入多重筛选以及在爬取后进行人工二次处理，如将返回值类型统一、修改csv文件方便数据库写入等。

在进行可视化页面设计时，需要在Django中创建一个可视化页面，用来展示数据绘制图，具体做法是利用Echarts集成，具体做法是：在web页面中使用Echarts的JavaScript库来创建和配置不同类型的图表，其中关键点是要实现数据交互和动态更新，做法是通过Ajax从服务器请求新的数据，并将其更新到图表中，以实现实时或动态的数据展示。

## 五、非功能需求

在进行可视化页面设计时，为了实现性能的优化，对数据进行异步加载，对于耗时的数据处理，采用异步加载的方式，确保页面快速加载，并在后台进行数据处理；对图表进行优化，使用合适的图表类型和数据粒度，避免加载过多或不必要的数据；压缩和合并前端资源（如 JavaScript 和 CSS 文件），减少页面加载时间。

## 六、数据来源及处理

进行项目爬取时，需要爬取Numpy和Pandas官方文档，并将其中的信息整理成五个部分：namespace及其隶属关系部分、method部分、property部分、return部分，然后导入Neo4j数据库中的节点和关系。由于这两个文档的布局和编写不统一，则需要在爬取过程中加入多重筛选，并在爬取后进行人工二次处理，以确保数据的准确性和规范性。

**具体流程如下：**

1. 爬取与筛选

   在进行爬取时，针对Numpy和Pandas文档的不同布局和格式进行多重筛选。将从文档中提取namespace及其隶属关系、method、property和return信息。然后，将把这些信息保存为结构化的数据，方便后续处理。

2. 人工二次处理

   由于文档的多样性，无法完全依赖自动爬取来确保数据的准确性和一致性。因此，会在爬取后进行人工二次处理，包括统一返回值类型，修改CSV文件以便更好地导入数据库。

3. 整理成五个部分

   * 为了将数据导入Neo4j数据库中的节点和关系，会将整理后的数据划分成五个节点部分，分别是：

     * namespace及其隶属关系部分：将不同namespace及其之间的隶属关系提取出来，以便在数据库中建立节点和关系。

     * method部分：提取每个method的名称和参数信息，并与对应的namespace关联。

     * property部分：提取每个property的名称和相关信息，并与对应的namespace关联。

     * return部分：提取每个method的返回值类型信息，并与对应的method关联。

   * 分成五个关系部分，分别是： 
     * has_method：确定namespace中包含的method
     * has_namespace：确定namespce是否包含另外的namespace
     * has_property：确定namespace中包含的property
     * has_class：确定namespace中包含的class
     * return_class：确定method和property的返回值属于的class

4. 导入Neo4j数据库

经过整理和处理后，将数据导入Neo4j数据库中。在数据库中建立合适的节点和关系，使得可以对Numpy和Pandas的信息进行查询和分析。

## 七、数据库

通过使用爬虫技术爬取Python官方的库函数说明文档，建立Neo4j数据库，该数据库中包含的节点有namespace（命名空间）、property（属性）、method（方法）、class（类）、root（根节点），其中的root是指导入的包，有numpy、pandas、一些内置包（List、Dict、Set、Str）。包含的关系有has_class（所包含的类）、has_method（所包含的方法）、has_property（所包含的属性）、has_namespace（所包含的命名空间）、return_class（返回值的类型）。

查询时，根据给定的结点限定条件，一步步查询得到给定代码的最后一个语句的下一结点，然后将其以列表的形式打包返回，实现代码提示功能。

## 八、界面需求

该项目的界面共有两个，一个是代码编写界面，一个是API查询界面。代码编写界面的网页背景采用了渐变色的效果，从上到下颜色从深到浅；页面顶部有一个导航栏，其中包含了网页的 logo、代码编写选项和 API 查询选项；在导航栏下方是一个代码编辑器的区域，通过 ACE 编辑器实现；页面使用了 Bootstrap 框架，因此具有响应式的设计，可以根据不同屏幕尺寸自动调整布局和样式，以提供更好的用户体验。

API查询界面的网页背景使用了线性渐变，从顶部的深蓝色逐渐变成底部的浅蓝色；图表使用了ECharts库来绘制，展示了一个图形化的数据结构。图表中的节点可以通过点击进行交互，用户点击节点后，会在面包屑导航中动态更新显示点击的节点路径；初始状态下，面包屑导航显示"Home"、"Library"和"Data"三个路径，用于表示页面所处的位置。当用户点击图表中的节点时，面包屑导航会根据点击节点的路径动态更新，每次点击会添加一个新的路径。用户可以通过点击路径中的链接，回到之前点击过的节点；页面中提供了一个搜索框，用户可以在搜索框中输入节点名称，然后点击"Search"按钮进行查询，查询结果会在图表中标示出来，方便用户快速定位目标节点；在图表显示上，初始状态，界面上呈现的就是所有root标签的节点：numpy、pandas、List、Dict、Set、Str，当点击其中的一个节点（以numpy为例），面包屑导航上显示路径‘numpy’，界面上显示的就是numpy指向的节点，是单路径，再点击numpy指向的任意节点，那么该节点就会写入上面的路径中，界面上会展示该节点关系到的其他节点，图表中会出现两级路径，之后再点击下一级节点就会继续写入路径中，界面上的路径级数进一步加深，当点击上面路径中的任意一个节点时，界面上的图表就会回到该级路径下的形式。

## 九、项目测试

* 代码编写测试：

  * 测试策略：需要测试三种导入包的方式、基本数据类型的解析、模糊数据类型的判断、确定数据类型的提示、模糊数据类型基于使用过的方法的提示。

  * 测试要求：需要正确存储包的导入、函数定义、工作区变量，正确判断数据类型，给出相应的代码提示。

* API查询测试：
  * 测试策略：需要测试点击节点跳转、面包屑导航跳转、节点查询、限制节点展示。
  * 测试要求：需要正确给出跳转的节点、展示节点关系。

## 十、时间进度

|   日期    | 工作任务或里程碑                                             |
| :-------: | :----------------------------------------------------------- |
| 2023/7/17 | 1.同指导老师讨论项目各项分工   <br />2.细化各项分工任务及完善   <br />3.完成项目相关文档   <br />4.完成项目初步 |
| 2023/7/18 | 1.完成数据的爬取及预处理   <br />2.完成数据库基本框架的搭建   <br />3.完成代码编辑器的初步搭建   <br />4.完成Python后端语意分析   <br />5.组内交流，确定后期任务 |
| 2023/7/19 | 1.根据前后端需求更新数据处理   <br />2.完成Python后端与Neo4j的交互，实现语法分析与Neo4j的结合   <br />3.结合后端模块完善前端编辑器   <br />4.美化Web可视化 |
| 2023/7/20 | 1.完成各模块调试收尾   <br />2.制作答辩展示PPT   <br />3.答辩演练 |
| 2023/7/21 | 1.项目答辩   <br />2.技术能力测评                            |
